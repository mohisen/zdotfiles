<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        
        <meta http-equiv="P3P" content="CP=\" idc="" dsp="" cor="" cura="" adma="" our="" ind="" phy="" onl="" com="" sta\""="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>default.py</title>
        
        


        
    
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class=" edit">

        <!-- NAVBAR 
        ============== -->
        <div id="header" class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div id="start" class="brand_wrapper">
                        <a href="https://127.0.0.1/admin/default/index" class="button brand"><span>web2py™ administrative interface</span></a>
                    </div>
                    <div class="nav-collapse">
                        
                        <ul id="menu" class="nav pull-right">
                            
                            <li><a class="button" href="https://127.0.0.1/admin/default/site"><span>Site</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/admin/default/design/arbani"><span>Edit</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/admin/default/about/arbani"><span>About</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/admin/default/errors/arbani"><span>Errors</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/admin/mercurial/commit/arbani"><span>Versioning</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/examples/default/documentation"><span>Help</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/admin/default/logout"><span>Logout</span></a></li>
                            
                            <li><a class="button" href="https://127.0.0.1/admin/debug/interact"><span>Debug</span></a></li>
                            
                        </ul>
                        
                    </div><!--/.nav-collapse -->
                </div><!-- /container-fluid -->
            </div><!-- /navbar-inner -->
        </div><!-- /#header -->

        <!-- MAIN 
        =========== -->
            <div id="main" class="container-fluid">
                <div id="main_inner" class="row-fluid">
                    <div class="span12">
                        <div style="display: none;" class="flash alert"></div>
                        
<!-- begin "edit" block -->

























<h2>Editing file "arbani/controllers/default.py"</h2>


  <p class="formfield well well-small">
<span style="text-align: left;" id="exposed">
  <b>exposes:</b> <a href="https://127.0.0.1/arbani/default/get_me_a_pdf">get_me_a_pdf</a>, <a href="https://127.0.0.1/arbani/default/get_me_a_pyfpdf">get_me_a_pyfpdf</a>, <a href="https://127.0.0.1/arbani/default/report">report</a>, <a href="https://127.0.0.1/arbani/default/listing">listing</a>, <a href="https://127.0.0.1/arbani/default/import_csv">import_csv</a>, <a href="https://127.0.0.1/arbani/default/invoice">invoice</a>, <a href="https://127.0.0.1/arbani/default/index">index</a>, <a href="https://127.0.0.1/arbani/default/user">user</a>, <a href="https://127.0.0.1/arbani/default/download">download</a>, <a href="https://127.0.0.1/arbani/default/call">call</a>
</span>
  <br>
  <b>edit views:</b>
  <a href="https://127.0.0.1/admin/default/edit/arbani/views/default/user.html">user</a>, <a href="https://127.0.0.1/admin/default/edit/arbani/views/default/index.html">index</a>
  
  </p>

<div class="row-fluid">
<p class="right controls pull-right">
  
      <a class="button special btn btn-inverse" name="breakpoint" onclick="return doToggleBreakpoint('arbani/controllers/default.py','https://127.0.0.1/admin/debug/toggle_breakpoint',null);" value="breakpoint"><span>toggle breakpoint</span></a>
    
  <a class="button btn" href="https://127.0.0.1/admin/default/design/arbani#controllers__default__py"><span>&lt;&lt;back</span></a>
  
  
  
  <a class="button btn" href="http://www.web2py.com/examples/static/epydoc/index.html" target="_top"><span>docs</span></a>
</p>
</div>
<div id="editor_area">
  <form action="https://127.0.0.1/admin/default/edit/arbani/controllers/default.py" method="post" name="editform" id="editform">
	<div class="editor-bar-column">
		<label>Save file:</label>
		<a value="save" name="save" onclick="return doClickSave();" class="icon saveicon" style="background-image: -webkit-linear-gradient(top,white,#E6E6E6);">
		<img alt="Save" src="save_icon.png">
		</a>
	</div>
	<div class="editor-bar-column">
		<div class="row-fluid">
			<div class="span7">
				<label>Saved file hash:</label>
				<input name="file_hash" value="b2c78db954ee6698db916ab840fbc325" class="input-long uneditable-input" readonly="readonly" type="input">
			</div>
			<div class="span5">
				<label>Last saved on:</label>
				<input name="saved_on" value="Fri May 24 05:01:33 2013" class="input-normal uneditable-input" readonly="readonly" type="input">
			</div>
		</div>
	</div>
    
    <textarea style="width: auto; height: auto; direction: ltr; display: none;" id="body" name="data"># -*- coding: utf-8 -*- 

#########################################################################
## This is a samples controller
## - index is the default action of any application
## - user is required for authentication and authorization
## - download is for downloading files uploaded in the db (does streaming)
## - call exposes all registered services (none by default)
#########################################################################  

from reportlab.platypus import *
from reportlab.lib.styles import getSampleStyleSheet
from reportlab.rl_config import defaultPageSize
from reportlab.lib.units import inch, mm
from reportlab.lib.enums import TA_LEFT, TA_RIGHT, TA_CENTER, TA_JUSTIFY
from reportlab.lib import colors
from uuid import uuid4
from cgi import escape
import os

def get_me_a_pdf():
    # Begin with regular font
    pdf.SetFont('Arial','',14)
    pdf.Write(5,'Visit ');
    # Then put a blue underlined link
    pdf.SetTextColor(0,0,255);
    pdf.SetFont('','U');
    pdf.Write(5,'www.fpdf.org','http://www.fpdf.org');
    title = "احمد باني"
    heading = "First Paragraph"
    text = 'bla '* 10000

    styles = getSampleStyleSheet()
    tmpfilename=os.path.join(request.folder,'private',str(uuid4()))
    doc = SimpleDocTemplate(tmpfilename)
    story = []
    story.append(Paragraph(escape(title),styles["Title"]))
    story.append(Paragraph(escape(heading),styles["Heading2"]))
    story.append(Paragraph(escape(text),styles["Normal"]))
    story.append(Spacer(1,2*inch))
    doc.build(story)
    data = open(tmpfilename,"rb").read()
    os.unlink(tmpfilename)
    response.headers['Content-Type']='application/pdf'
    return data

from gluon.contrib.pyfpdf import FPDF
import os

def get_me_a_pyfpdf():
    title = "This The Doc Title"
    heading = "First Paragraph"
    text = 'bla '* 10000

    pdf=FPDF()
    pdf.add_page()
    pdf.set_font('Times','B',15)
    pdf.cell(w=210,h=9,txt=title,border=0,ln=1,align='C',fill=0)
    pdf.set_font('Times','B',15)
    pdf.cell(w=0,h=6,txt=heading,border=0,ln=1,align='L',fill=0)
    pdf.set_font('Times','',12)
    pdf.multi_cell(w=0,h=5,txt=text)
    response.headers['Content-Type']='application/pdf'
    return pdf.output(dest='S')

def report():
    response.title = "web2py sample report"
    
    # include a google chart!
    url = "http://chart.apis.google.com/chart?cht=p3&amp;chd=t:60,40&amp;chs=250x100&amp;chl=Hello|World&amp;.png"
    chart = IMG(_src=url, _width="250",_height="100")

    # create a small table with some data:
    rows = [THEAD(TR(TH("Key",_width="70%"), TH("Value",_width="30%"))),
            TBODY(TR(TD("Hello"),TD("60")), 
                  TR(TD("World"),TD("40")))]
    table = TABLE(*rows, _border="0", _align="center", _width="50%")

    if request.extension=="pdf":
        from gluon.contrib.pyfpdf import FPDF, HTMLMixin

        # create a custom class with the required functionalities 
        class MyFPDF(FPDF, HTMLMixin):
            def header(self): 
                "hook to draw custom page header"
                logo=os.path.join(request.env.web2py_path,"gluon","contrib","pyfpdf","tutorial","logo_pb.png")
                self.image(logo,10,8,33)
                self.set_font('Arial','B',15)
                self.cell(65) # padding
                self.cell(60,10,response.title,1,0,'C')
                self.ln(20)
                
            def footer(self):
                "hook to draw custom page header (printing page numbers)"
                self.set_y(-15)
                self.set_font('Arial','I',8)
                txt = 'Page %s of %s' % (self.page_no(), self.alias_nb_pages())
                self.cell(0,10,txt,0,0,'C')
                    
        pdf=MyFPDF()
        # create a page and serialize/render HTML objects
        pdf.add_page()
        pdf.write_html(str(XML(table, sanitize=False)))
        pdf.write_html(str(XML(CENTER(chart), sanitize=False)))
        # prepare PDF to download:
        response.headers['Content-Type']='application/pdf'
        return pdf.output(dest='S')
    else:
        # normal html view:
        return dict(chart=chart, table=table)

def listing():
    response.title = "web2py sample listing"
    
    # define header and footers:
    head = THEAD(TR(TH("Header 1",_width="50%"), 
                    TH("Header 2",_width="30%"),
                    TH("Header 3",_width="20%"), 
                    _bgcolor="#A0A0A0"))
    foot = TFOOT(TR(TH("Footer 1",_width="50%"), 
                    TH("Footer 2",_width="30%"),
                    TH("Footer 3",_width="20%"),
                    _bgcolor="#E0E0E0"))
    
    # create several rows:
    rows = []
    for i in range(1000):
        col = i % 2 and "#F0F0F0" or "#FFFFFF"
        rows.append(TR(TD("Row %s" %i),
                       TD("something", _align="center"),
                       TD("%s" % i, _align="right"),
                       _bgcolor=col)) 

    # make the table object
    body = TBODY(*rows)
    table = TABLE(*[head,foot, body], 
                  _border="1", _align="center", _width="100%")

    if request.extension=="pdf":
        from gluon.contrib.pyfpdf import FPDF, HTMLMixin

        # define our FPDF class (move to modules if it is reused  frequently)
        class MyFPDF(FPDF, HTMLMixin):
            def header(self):
                self.set_font('Arial','B',15)
                self.cell(0,10, response.title ,1,0,'C')
                self.ln(20)
                
            def footer(self):
                self.set_y(-15)
                self.set_font('Arial','I',8)
                txt = 'Page %s of %s' % (self.page_no(), self.alias_nb_pages())
                self.cell(0,10,txt,0,0,'C')
                    
        pdf=MyFPDF()
        # first page:
        pdf.add_page()
        pdf.write_html(str(XML(table, sanitize=False)))
        response.headers['Content-Type']='application/pdf'
        return pdf.output(dest='S')
    else:
        # normal html view:
        return dict(table=table)
        

def import_csv():
    from gluon.contrib.pyfpdf import Template
    
    f = Template()
    f.parse_csv(infile="/home/reingart/web2py/gluon/contrib/pyfpdf/invoice.csv", delimiter=";", decimal_sep=",")
    for v in f.fields.elements():
        v['align']=  {'I':'L','D':'R','C':'C','':''}.get(v['align'], 'L')
        v['pdf_template_id'] = 1
        db.pdf_element.insert(**v)

def invoice():
    from gluon.contrib.pyfpdf import Template
    import os.path
    
    # generate sample invoice (according Argentina's regulations)

    import random
    from decimal import Decimal

    # read elements from db 
    
    elements = db(db.pdf_element.pdf_template_id==1).select(orderby=db.pdf_element.priority)

    f = Template(format="A4",
             elements = elements,
             title="Sample Invoice", author="Sample Company",
             subject="Sample Customer", keywords="Electronic TAX Invoice")
    
    detail = "Lorem ipsum dolor sit amet, consectetur. " * 5
    items = []
    for i in range(1, 30):
        ds = "Sample product %s" % i
        qty = random.randint(1,10)
        price = round(random.random()*100,3)
        code = "%s%s%02d" % (chr(random.randint(65,90)), chr(random.randint(65,90)),i)
        items.append(dict(code=code, unit='u',
                          qty=qty, price=price, 
                          amount=qty*price,
                          ds="%s: %s" % (i,ds)))

    # divide and count lines
    lines = 0
    li_items = []
    for it in items:
        qty = it['qty']
        code = it['code']
        unit = it['unit']
        for ds in f.split_multicell(it['ds'], 'item_description01'):
            # add item description line (without price nor amount)
            li_items.append(dict(code=code, ds=ds, qty=qty, unit=unit, price=None, amount=None))
            # clean qty and code (show only at first)
            unit = qty = code = None
        # set last item line price and amount
        li_items[-1].update(amount = it['amount'],
                            price = it['price'])

    obs="\n&lt;U&gt;Detail:&lt;/U&gt;\n\n" + detail
    for ds in f.split_multicell(obs, 'item_description01'):
        li_items.append(dict(code=code, ds=ds, qty=qty, unit=unit, price=None, amount=None))

    # calculate pages:
    lines = len(li_items)
    max_lines_per_page = 24
    pages = lines / (max_lines_per_page - 1)
    if lines % (max_lines_per_page - 1): pages = pages + 1

    # completo campos y hojas
    for page in range(1, pages+1):
        f.add_page()
        f['page'] = 'Page %s of %s' % (page, pages)
        if pages&gt;1 and page&lt;pages:
            s = 'Continues on page %s' % (page+1)
        else:
            s = ''
        f['item_description%02d' % (max_lines_per_page+1)] = s

        f["company_name"] = "Sample Company"
        f["company_logo"] = os.path.join(request.env.web2py_path,"gluon","contrib","pyfpdf","tutorial","logo.png")
        f["company_header1"] = "Some Address - somewhere -"
        f["company_header2"] = "http://www.example.com"        
        f["company_footer1"] = "Tax Code ..."
        f["company_footer2"] = "Tax/VAT ID ..."
        f['number'] = '0001-00001234'
        f['issue_date'] = '2010-09-10'
        f['due_date'] = '2099-09-10'
        f['customer_name'] = "Sample Client"
        f['customer_address'] = "Siempreviva 1234"
       
        # print line item...
        li = 0 
        k = 0
        total = Decimal("0.00")
        for it in li_items:
            k = k + 1
            if k &gt; page * (max_lines_per_page - 1):
                break
            if it['amount']:
                total += Decimal("%.6f" % it['amount'])
            if k &gt; (page - 1) * (max_lines_per_page - 1):
                li += 1
                if it['qty'] is not None:
                    f['item_quantity%02d' % li] = it['qty']
                if it['code'] is not None:
                    f['item_code%02d' % li] = it['code']
                if it['unit'] is not None:
                    f['item_unit%02d' % li] = it['unit']
                f['item_description%02d' % li] = it['ds']
                if it['price'] is not None:
                    f['item_price%02d' % li] = "%0.3f" % it['price']
                if it['amount'] is not None:
                    f['item_amount%02d' % li] = "%0.2f" % it['amount']

        if pages == page:
            f['net'] = "%0.2f" % (total/Decimal("1.21"))
            f['vat'] = "%0.2f" % (total*(1-1/Decimal("1.21")))
            f['total_label'] = 'Total:'
        else:
            f['total_label'] = 'SubTotal:'
        f['total'] = "%0.2f" % total

    response.headers['Content-Type']='application/pdf'
    return f.render('invoice.pdf', dest='S')

def index():
    """
    example action using the internationalization operator T and flash
    rendered by views/default/index.html or views/generic.html
    """
    response.flash = T('Welcome to web2py')
    return dict(message=T('Hello World'))


def user():
    """
    exposes:
    http://..../[app]/default/user/login 
    http://..../[app]/default/user/logout
    http://..../[app]/default/user/register
    http://..../[app]/default/user/profile
    http://..../[app]/default/user/retrieve_password
    http://..../[app]/default/user/change_password
    use @auth.requires_login()
        @auth.requires_membership('group name')
        @auth.requires_permission('read','table name',record_id)
    to decorate functions that need access control
    """
    return dict(form=auth())


def download():
    """
    allows downloading of uploaded files
    http://..../[app]/default/download/[filename]
    """
    return response.download(request,db)


def call():
    """
    exposes services. for example:
    http://..../[app]/default/call/jsonrpc
    decorate with @services.jsonrpc the functions to expose
    supports xml, json, xmlrpc, jsonrpc, amfrpc, rss, csv
    """
    session.forget()
    return service()
</textarea><img style="cursor: pointer ! important; display: none ! important; position: absolute ! important; padding: 0px ! important; margin: 0px ! important; border: medium none ! important; width: 28px ! important; height: 14px ! important; opacity: 0.0152174 ! important;" title="It's All Text!" src="chrome://itsalltext/locale/gumdrop.png"><div class="CodeMirror CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59998px; left: 41.6px;"><textarea id="itsalltext_generated_id__1" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em;"></textarea><img style="cursor: pointer ! important; display: block ! important; position: absolute ! important; padding: 0px ! important; margin: 0px ! important; border: medium none ! important; width: 28px ! important; height: 14px ! important; opacity: 0.7 ! important; left: 1px ! important; top: 16px ! important;" title="It's All Text!" src="chrome://itsalltext/locale/gumdrop.png"></div><div style="display: block; height: 300px;" class="CodeMirror-scrollbar"><div style="height: 9067.2px;" class="CodeMirror-scrollbar-inner"></div></div><div style="height: auto; overflow-x: auto;" draggable="true" tabindex="-1" class="CodeMirror-scroll cm-s-web2py CodeMirror-focused"><div style="position: relative; min-height: 9067.2px;"><div style="position: relative; top: 0px;"><div style="height: 3186px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3<br>&nbsp;</pre><pre>4</pre><pre>5<br>&nbsp;</pre><pre>6<br>&nbsp;</pre><pre>7<br>&nbsp;</pre><pre>8<br>&nbsp;</pre><pre>9<br>&nbsp;</pre><pre>10</pre><pre>11</pre><pre>12<br>&nbsp;</pre><pre>13<br>&nbsp;</pre><pre>14<br>&nbsp;</pre><pre>15<br>&nbsp;</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre><pre>20</pre><pre>21</pre><pre>22</pre><pre>23</pre><pre>24</pre><pre>25</pre><pre>26</pre><pre>27</pre><pre>28<br>&nbsp;<br>&nbsp;</pre><pre>29</pre><pre>30</pre><pre>31</pre><pre>32</pre><pre>33</pre><pre>34<br>&nbsp;<br>&nbsp;</pre><pre>35</pre><pre>36</pre><pre>37<br>&nbsp;<br>&nbsp;</pre><pre>38<br>&nbsp;<br>&nbsp;</pre><pre>39<br>&nbsp;<br>&nbsp;</pre><pre>40</pre><pre>41</pre><pre>42</pre><pre>43</pre><pre>44<br>&nbsp;</pre><pre>45</pre><pre>46</pre><pre>47</pre><pre>48</pre><pre>49</pre><pre>50</pre><pre>51</pre><pre>52</pre><pre>53</pre><pre>54</pre><pre>55</pre><pre>56</pre><pre>57</pre><pre>58<br>&nbsp;<br>&nbsp;</pre><pre>59</pre><pre>60<br>&nbsp;<br>&nbsp;</pre><pre>61</pre><pre>62</pre><pre>63<br>&nbsp;</pre><pre>64</pre><pre>65</pre><pre>66</pre><pre>67<br>&nbsp;</pre><pre>68</pre><pre>69</pre><pre>70<br>&nbsp;<br>&nbsp;</pre><pre>71<br>&nbsp;</pre><pre>72</pre><pre>73<br>&nbsp;</pre><pre>74<br>&nbsp;<br>&nbsp;</pre><pre>75<br>&nbsp;</pre><pre>76<br>&nbsp;</pre><pre>77<br>&nbsp;</pre><pre>78</pre><pre>79</pre><pre>80<br>&nbsp;</pre><pre>81</pre><pre>82<br>&nbsp;</pre><pre>83</pre><pre>84</pre><pre>85<br>&nbsp;</pre><pre>86<br>&nbsp;<br>&nbsp;<br>&nbsp;</pre><pre>87</pre><pre>88<br>&nbsp;</pre><pre>89</pre><pre>90<br>&nbsp;</pre><pre>91</pre><pre>92</pre><pre>93</pre><pre>94<br>&nbsp;</pre><pre>95</pre><pre>96<br>&nbsp;</pre><pre>97<br>&nbsp;</pre><pre>98<br>&nbsp;</pre><pre>99</pre><pre>100</pre><pre>101<br>&nbsp;</pre><pre>102</pre><pre>103<br>&nbsp;</pre><pre>104<br>&nbsp;<br>&nbsp;</pre><pre>105</pre><pre>106<br>&nbsp;</pre><pre>107</pre><pre>108</pre><pre>109</pre></div></div><div class="CodeMirror-lines"><div style="position: relative; z-index: 0; outline: medium none; margin-left: 36px;"><div style="position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px; visibility: hidden;" class="CodeMirror-cursor">&nbsp;</pre><pre style="visibility: hidden;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre class="activeline"><span class="cm-comment"># -*- coding: utf-8 -*- </span></pre><pre> </pre><pre><span class="cm-comment">#########################################################################</span></pre><pre><span class="cm-comment">## This is a samples controller</span></pre><pre><span class="cm-comment">## - index is the default action of any application</span></pre><pre><span class="cm-comment">## - user is required for authentication and authorization</span></pre><pre><span class="cm-comment">## - download is for downloading files uploaded in the db (does streaming)</span></pre><pre><span class="cm-comment">## - call exposes all registered services (none by default)</span></pre><pre><span class="cm-comment">#########################################################################  </span></pre><pre> </pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">reportlab</span>.<span class="cm-variable">platypus</span> <span class="cm-keyword">import</span> <span class="cm-operator">*</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">reportlab</span>.<span class="cm-variable">lib</span>.<span class="cm-variable">styles</span> <span class="cm-keyword">import</span> <span class="cm-variable">getSampleStyleSheet</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">reportlab</span>.<span class="cm-variable">rl_config</span> <span class="cm-keyword">import</span> <span class="cm-variable">defaultPageSize</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">reportlab</span>.<span class="cm-variable">lib</span>.<span class="cm-variable">units</span> <span class="cm-keyword">import</span> <span class="cm-variable">inch</span>, <span class="cm-variable">mm</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">reportlab</span>.<span class="cm-variable">lib</span>.<span class="cm-variable">enums</span> <span class="cm-keyword">import</span> <span class="cm-variable">TA_LEFT</span>, <span class="cm-variable">TA_RIGHT</span>, <span class="cm-variable">TA_CENTER</span>, <span class="cm-variable">TA_JUSTIFY</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">reportlab</span>.<span class="cm-variable">lib</span> <span class="cm-keyword">import</span> <span class="cm-variable">colors</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">uuid</span> <span class="cm-keyword">import</span> <span class="cm-variable">uuid4</span></pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">cgi</span> <span class="cm-keyword">import</span> <span class="cm-variable">escape</span></pre><pre><span class="cm-keyword">import</span> <span class="cm-variable">os</span></pre><pre> </pre><pre><span class="cm-keyword">def</span> <span class="cm-variable">get_me_a_pdf</span>():</pre><pre>    <span class="cm-comment"># Begin with regular font</span></pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">SetFont</span>(<span class="cm-string">'Arial'</span>,<span class="cm-string">''</span>,<span class="cm-number">14</span>)</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">Write</span>(<span class="cm-number">5</span>,<span class="cm-string">'Visit '</span>);</pre><pre>    <span class="cm-comment"># Then put a blue underlined link</span></pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">SetTextColor</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-number">255</span>);</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">SetFont</span>(<span class="cm-string">''</span>,<span class="cm-string">'U'</span>);</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">Write</span>(<span class="cm-number">5</span>,<span class="cm-string">'www.fpdf.org'</span>,<span class="cm-string">'http://www.fpdf.org'</span>);</pre><pre>    <span class="cm-variable">title</span> = <span class="cm-string">"احمد باني"</span></pre><pre>    <span class="cm-variable">heading</span> = <span class="cm-string">"First Paragraph"</span></pre><pre>    <span class="cm-variable">text</span> = <span class="cm-string">'bla '</span><span class="cm-operator">*</span> <span class="cm-number">10000</span></pre><pre> </pre><pre>    <span class="cm-variable">styles</span> = <span class="cm-variable">getSampleStyleSheet</span>()</pre><pre>    <span class="cm-variable">tmpfilename</span>=<span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">join</span>(<span class="cm-variable">request</span>.<span class="cm-variable">folder</span>,<span class="cm-string">'private'</span>,<span class="cm-builtin">str</span>(<span class="cm-variable">uuid4</span>()))</pre><pre>    <span class="cm-variable">doc</span> = <span class="cm-variable">SimpleDocTemplate</span>(<span class="cm-variable">tmpfilename</span>)</pre><pre>    <span class="cm-variable">story</span> = []</pre><pre>    <span class="cm-variable">story</span>.<span class="cm-variable">append</span>(<span class="cm-variable">Paragraph</span>(<span class="cm-variable">escape</span>(<span class="cm-variable">title</span>),<span class="cm-variable">styles</span>[<span class="cm-string">"Title"</span>]))</pre><pre>    <span class="cm-variable">story</span>.<span class="cm-variable">append</span>(<span class="cm-variable">Paragraph</span>(<span class="cm-variable">escape</span>(<span class="cm-variable">heading</span>),<span class="cm-variable">styles</span>[<span class="cm-string">"Heading2"</span>]))</pre><pre>    <span class="cm-variable">story</span>.<span class="cm-variable">append</span>(<span class="cm-variable">Paragraph</span>(<span class="cm-variable">escape</span>(<span class="cm-variable">text</span>),<span class="cm-variable">styles</span>[<span class="cm-string">"Normal"</span>]))</pre><pre>    <span class="cm-variable">story</span>.<span class="cm-variable">append</span>(<span class="cm-variable">Spacer</span>(<span class="cm-number">1</span>,<span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">inch</span>))</pre><pre>    <span class="cm-variable">doc</span>.<span class="cm-variable">build</span>(<span class="cm-variable">story</span>)</pre><pre>    <span class="cm-variable">data</span> = <span class="cm-builtin">open</span>(<span class="cm-variable">tmpfilename</span>,<span class="cm-string">"rb"</span>).<span class="cm-variable">read</span>()</pre><pre>    <span class="cm-variable">os</span>.<span class="cm-variable">unlink</span>(<span class="cm-variable">tmpfilename</span>)</pre><pre>    <span class="cm-variable">response</span>.<span class="cm-variable">headers</span>[<span class="cm-string">'Content-Type'</span>]=<span class="cm-string">'application/pdf'</span></pre><pre>    <span class="cm-keyword">return</span> <span class="cm-variable">data</span></pre><pre> </pre><pre><span class="cm-keyword">from</span> <span class="cm-variable">gluon</span>.<span class="cm-variable">contrib</span>.<span class="cm-variable">pyfpdf</span> <span class="cm-keyword">import</span> <span class="cm-variable">FPDF</span></pre><pre><span class="cm-keyword">import</span> <span class="cm-variable">os</span></pre><pre> </pre><pre><span class="cm-keyword">def</span> <span class="cm-variable">get_me_a_pyfpdf</span>():</pre><pre>    <span class="cm-variable">title</span> = <span class="cm-string">"This The Doc Title"</span></pre><pre>    <span class="cm-variable">heading</span> = <span class="cm-string">"First Paragraph"</span></pre><pre>    <span class="cm-variable">text</span> = <span class="cm-string">'bla '</span><span class="cm-operator">*</span> <span class="cm-number">10000</span></pre><pre> </pre><pre>    <span class="cm-variable">pdf</span>=<span class="cm-variable">FPDF</span>()</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">add_page</span>()</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">set_font</span>(<span class="cm-string">'Times'</span>,<span class="cm-string">'B'</span>,<span class="cm-number">15</span>)</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">cell</span>(<span class="cm-variable">w</span>=<span class="cm-number">210</span>,<span class="cm-variable">h</span>=<span class="cm-number">9</span>,<span class="cm-variable">txt</span>=<span class="cm-variable">title</span>,<span class="cm-variable">border</span>=<span class="cm-number">0</span>,<span class="cm-variable">ln</span>=<span class="cm-number">1</span>,<span class="cm-variable">align</span>=<span class="cm-string">'C'</span>,<span class="cm-variable">fill</span>=<span class="cm-number">0</span>)</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">set_font</span>(<span class="cm-string">'Times'</span>,<span class="cm-string">'B'</span>,<span class="cm-number">15</span>)</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">cell</span>(<span class="cm-variable">w</span>=<span class="cm-number">0</span>,<span class="cm-variable">h</span>=<span class="cm-number">6</span>,<span class="cm-variable">txt</span>=<span class="cm-variable">heading</span>,<span class="cm-variable">border</span>=<span class="cm-number">0</span>,<span class="cm-variable">ln</span>=<span class="cm-number">1</span>,<span class="cm-variable">align</span>=<span class="cm-string">'L'</span>,<span class="cm-variable">fill</span>=<span class="cm-number">0</span>)</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">set_font</span>(<span class="cm-string">'Times'</span>,<span class="cm-string">''</span>,<span class="cm-number">12</span>)</pre><pre>    <span class="cm-variable">pdf</span>.<span class="cm-variable">multi_cell</span>(<span class="cm-variable">w</span>=<span class="cm-number">0</span>,<span class="cm-variable">h</span>=<span class="cm-number">5</span>,<span class="cm-variable">txt</span>=<span class="cm-variable">text</span>)</pre><pre>    <span class="cm-variable">response</span>.<span class="cm-variable">headers</span>[<span class="cm-string">'Content-Type'</span>]=<span class="cm-string">'application/pdf'</span></pre><pre>    <span class="cm-keyword">return</span> <span class="cm-variable">pdf</span>.<span class="cm-variable">output</span>(<span class="cm-variable">dest</span>=<span class="cm-string">'S'</span>)</pre><pre> </pre><pre><span class="cm-keyword">def</span> <span class="cm-variable">report</span>():</pre><pre>    <span class="cm-variable">response</span>.<span class="cm-variable">title</span> = <span class="cm-string">"web2py sample report"</span></pre><pre>    </pre><pre>    <span class="cm-comment"># include a google chart!</span></pre><pre>    <span class="cm-variable">url</span> = <span class="cm-string">"http://chart.apis.google.com/chart?cht=p3&amp;chd=t:60,40&amp;chs=250x100&amp;chl=Hello|World&amp;.png"</span></pre><pre>    <span class="cm-variable">chart</span> = <span class="cm-variable">IMG</span>(<span class="cm-variable">_src</span>=<span class="cm-variable">url</span>, <span class="cm-variable">_width</span>=<span class="cm-string">"250"</span>,<span class="cm-variable">_height</span>=<span class="cm-string">"100"</span>)</pre><pre> </pre><pre>    <span class="cm-comment"># create a small table with some data:</span></pre><pre>    <span class="cm-variable">rows</span> = [<span class="cm-variable">THEAD</span>(<span class="cm-variable">TR</span>(<span class="cm-variable">TH</span>(<span class="cm-string">"Key"</span>,<span class="cm-variable">_width</span>=<span class="cm-string">"70%"</span>), <span class="cm-variable">TH</span>(<span class="cm-string">"Value"</span>,<span class="cm-variable">_width</span>=<span class="cm-string">"30%"</span>))),</pre><pre>            <span class="cm-variable">TBODY</span>(<span class="cm-variable">TR</span>(<span class="cm-variable">TD</span>(<span class="cm-string">"Hello"</span>),<span class="cm-variable">TD</span>(<span class="cm-string">"60"</span>)), </pre><pre>                  <span class="cm-variable">TR</span>(<span class="cm-variable">TD</span>(<span class="cm-string">"World"</span>),<span class="cm-variable">TD</span>(<span class="cm-string">"40"</span>)))]</pre><pre>    <span class="cm-variable">table</span> = <span class="cm-variable">TABLE</span>(<span class="cm-operator">*</span><span class="cm-variable">rows</span>, <span class="cm-variable">_border</span>=<span class="cm-string">"0"</span>, <span class="cm-variable">_align</span>=<span class="cm-string">"center"</span>, <span class="cm-variable">_width</span>=<span class="cm-string">"50%"</span>)</pre><pre> </pre><pre>    <span class="cm-keyword">if</span> <span class="cm-variable">request</span>.<span class="cm-variable">extension</span><span class="cm-operator">==</span><span class="cm-string">"pdf"</span>:</pre><pre>        <span class="cm-keyword">from</span> <span class="cm-variable">gluon</span>.<span class="cm-variable">contrib</span>.<span class="cm-variable">pyfpdf</span> <span class="cm-keyword">import</span> <span class="cm-variable">FPDF</span>, <span class="cm-variable">HTMLMixin</span></pre><pre> </pre><pre>        <span class="cm-comment"># create a custom class with the required functionalities </span></pre><pre>        <span class="cm-keyword">class</span> <span class="cm-variable">MyFPDF</span>(<span class="cm-variable">FPDF</span>, <span class="cm-variable">HTMLMixin</span>):</pre><pre>            <span class="cm-keyword">def</span> <span class="cm-variable">header</span>(<span class="cm-variable">self</span>): </pre><pre>                <span class="cm-string">"hook to draw custom page header"</span></pre><pre>                <span class="cm-variable">logo</span>=<span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">join</span>(<span class="cm-variable">request</span>.<span class="cm-variable">env</span>.<span class="cm-variable">web2py_path</span>,<span class="cm-string">"gluon"</span>,<span class="cm-string">"contrib"</span>,<span class="cm-string">"pyfpdf"</span>,<span class="cm-string">"tutorial"</span>,<span class="cm-string">"logo_pb.png"</span>)</pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">image</span>(<span class="cm-variable">logo</span>,<span class="cm-number">10</span>,<span class="cm-number">8</span>,<span class="cm-number">33</span>)</pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">set_font</span>(<span class="cm-string">'Arial'</span>,<span class="cm-string">'B'</span>,<span class="cm-number">15</span>)</pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">cell</span>(<span class="cm-number">65</span>) <span class="cm-comment"># padding</span></pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">cell</span>(<span class="cm-number">60</span>,<span class="cm-number">10</span>,<span class="cm-variable">response</span>.<span class="cm-variable">title</span>,<span class="cm-number">1</span>,<span class="cm-number">0</span>,<span class="cm-string">'C'</span>)</pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">ln</span>(<span class="cm-number">20</span>)</pre><pre>                </pre><pre>            <span class="cm-keyword">def</span> <span class="cm-variable">footer</span>(<span class="cm-variable">self</span>):</pre><pre>                <span class="cm-string">"hook to draw custom page header (printing page numbers)"</span></pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">set_y</span>(<span class="cm-operator">-</span><span class="cm-number">15</span>)</pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">set_font</span>(<span class="cm-string">'Arial'</span>,<span class="cm-string">'I'</span>,<span class="cm-number">8</span>)</pre><pre>                <span class="cm-variable">txt</span> = <span class="cm-string">'Page %s of %s'</span> <span class="cm-operator">%</span> (<span class="cm-variable">self</span>.<span class="cm-variable">page_no</span>(), <span class="cm-variable">self</span>.<span class="cm-variable">alias_nb_pages</span>())</pre><pre>                <span class="cm-variable">self</span>.<span class="cm-variable">cell</span>(<span class="cm-number">0</span>,<span class="cm-number">10</span>,<span class="cm-variable">txt</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-string">'C'</span>)</pre><pre>                    </pre><pre>        <span class="cm-variable">pdf</span>=<span class="cm-variable">MyFPDF</span>()</pre><pre>        <span class="cm-comment"># create a page and serialize/render HTML objects</span></pre><pre>        <span class="cm-variable">pdf</span>.<span class="cm-variable">add_page</span>()</pre><pre>        <span class="cm-variable">pdf</span>.<span class="cm-variable">write_html</span>(<span class="cm-builtin">str</span>(<span class="cm-variable">XML</span>(<span class="cm-variable">table</span>, <span class="cm-variable">sanitize</span>=<span class="cm-builtin">False</span>)))</pre><pre>        <span class="cm-variable">pdf</span>.<span class="cm-variable">write_html</span>(<span class="cm-builtin">str</span>(<span class="cm-variable">XML</span>(<span class="cm-variable">CENTER</span>(<span class="cm-variable">chart</span>), <span class="cm-variable">sanitize</span>=<span class="cm-builtin">False</span>)))</pre><pre>        <span class="cm-comment"># prepare PDF to download:</span></pre><pre>        <span class="cm-variable">response</span>.<span class="cm-variable">headers</span>[<span class="cm-string">'Content-Type'</span>]=<span class="cm-string">'application/pdf'</span></pre><pre>        <span class="cm-keyword">return</span> <span class="cm-variable">pdf</span>.<span class="cm-variable">output</span>(<span class="cm-variable">dest</span>=<span class="cm-string">'S'</span>)</pre><pre>    <span class="cm-keyword">else</span>:</pre><pre>        <span class="cm-comment"># normal html view:</span></pre></div></div></div></div></div></div></div>
    
    
	<div class="editor-bar-bottom" style="margin-top: 9px;">
		<button class="editbutton btn" onclick="window.location.reload(); return false">restore</button>
		currently saved or
		<button class="editbutton btn" type="submit" name="revert">revert</button>
		to  previous version.
	</div>
    <br>
  </form>
</div>

<div class="row-fluid">
	<div class="help span4 alert alert-block alert-info">
		
		<h3>Key bindings</h3>
		<ul class="keybindings unstyled">
			<li><span class="teletype-text">Ctrl+S</span><span>Save via Ajax</span></li>
			<li><span class="teletype-text">Ctrl+F11</span><span>Toggle Fullscreen</span></li>
			<li><span class="teletype-text">Ctrl-F / Cmd-F</span><span>Start searching</span></li>
			<li><span class="teletype-text">Ctrl-G / Cmd-G</span><span>Find Next</span></li>
			<li><span class="teletype-text">Shift-Ctrl-G / Shift-Cmd-G</span><span>Find Previous</span></li>
			<li><span class="teletype-text">Shift-Ctrl-F / Cmd-Option-F</span><span>Replace</span></li>
			<li><span class="teletype-text">Shift-Ctrl-R / Shift-Cmd-Option-F</span><span>Replace All</span></li>
		</ul>
		
	</div>
</div>
<!-- end "edit" block -->

                    </div><!-- /main span12 -->
                </div><!-- /main row-fluid -->
            </div><!-- /#main -->

        <!-- FOOTER 
        ============== -->
        <footer id="footer" class="fixed">
            <p><span>Powered by <a href="http://www.web2py.com/">web2py</a>™ created by Massimo Di Pierro ©2007-2013
                
                - Admin language</span>
                <select name="adminlanguage" onchange="var date = new Date();cookieDate=date.setTime(date.getTime()+(100*24*60*60*1000));document.cookie='adminLanguage='+this.options[this.selectedIndex].id+'; expires='+cookieDate+'; path=/';window.location.reload()">
                    
                    <option id="af">Afrikaanse</option>
                    
                    <option id="bg">Български</option>
                    
                    <option id="cs">čeština</option>
                    
                    <option id="de">Deutsch</option>
                    
                    <option selected="" id="en-us">English (US)</option>
                    
                    <option id="es">Español</option>
                    
                    <option id="fr">Français</option>
                    
                    <option id="he">עברית</option>
                    
                    <option id="it">Italiano</option>
                    
                    <option id="ja">日本語</option>
                    
                    <option id="nl">Nederlands</option>
                    
                    <option id="pl">Polska</option>
                    
                    <option id="pt">Português</option>
                    
                    <option id="ro">Română</option>
                    
                    <option id="ru">Русский</option>
                    
                    <option id="sl">Slovenski</option>
                    
                    <option id="sr-cr">Српски (Ћирилица)</option>
                    
                    <option id="sr-lt">Srpski (Latinica)</option>
                    
                    <option id="uk">Українська</option>
                    
                    <option id="zh">中文</option>
                    
                    <option id="zh-tw">台灣中文</option>
                    
                </select>
                
            </p>
        </footer><!-- /#footer -->

        <!-- BS JAVASCRIPT 
        ====================== -->
        
        
	
    

</body>
</html>
